# Test Investigation and Recommendations

## 1. Current Test Status
- As of the latest check, running `ChessTests` shows **0 failing tests**. All current tests pass successfully.
- Command to reproduce: `cmake --build build --config Release --target ChessTests && ./build/ChessTests`
- Output: `All tests passed!`

## 2. Test Comprehensiveness & Coverage Gaps
The current test suite (`chess-analysis-app/tests/test_runner.cpp`) is minimal and primarily focuses on basic board state and some `core` components. It lacks coverage in several key areas:

### `src/core/` (Chess Logic)
- **Missing Specific Move Rule Tests:** While basic castling is tested, there are no isolated tests for **En Passant** captures, **Pawn Promotion** variations (Queen, Rook, Bishop, Knight), or checks generated by these moves.
- **Game State Tests:** The current tests only cover `isInsufficientMaterial` and basic `isCheck`. Tests should be added explicitly for **Checkmate** and **Stalemate** scenarios with specifically crafted FENs.
- **Move Generation Edge Cases:** No tests verify behavior when pieces are pinned, or if pseudo-legal moves incorrectly expose the king to danger.
- **Game Record (`game_record.hpp`):** No tests explicitly check navigating the game history backwards and forwards accurately beyond a simple undo-move state.

### `src/engine/` (Stockfish Integration)
- **No Engine Tests:** `stockfish.cpp` and `stockfish.hpp` are completely untested.
- **Recommendation:** Tests should mock the input/output Win32 pipes to ensure that the engine class correctly parses evaluation metrics (centipawns, mates) and best move suggestions from UCI format without relying on a real background process during unit testing.

### `GUI / Main application` (`main.cpp`)
- **No UI/Integration Tests:** Drag & Drop features (`.pgn`/`.fen`), clipboard interactions (`Paste PGN`), and click-to-move input logic remain completely unverified by automation.
- **Recommendation:** Isolate non-rendering GUI state (e.g., input processing and board state synchronization) so it can be tested independently of Raylib context creation.

## 3. Test Efficiency & Framework Architecture
The current testing setup is highly inefficient for a growing codebase:

- **Custom Macros are Brittle:** The tests rely on custom macros (`EXPECT_EQ`, `EXPECT_TRUE`) that immediately abort the program (`exit(1)`) on the first failure. This prevents developers from seeing all failures at once.
- **Lack of Test Discovery:** All tests must be manually added to `main()` in `test_runner.cpp`.
- **Recommendation:** Migrate from the custom `test_runner.cpp` to a modern C++ testing framework like **Google Test (gtest)** or **Catch2**. This provides granular test reporting, non-fatal assertions, test discovery, and isolated test contexts.
- **Perft Performance:** The current `perft` implementation is a naive recursive node counter. While sufficient for verifying small depths (up to depth 4 is currently tested), it lacks a transposition table (TT) or bulk-counting optimizations. Testing higher depths to ensure robust move generation will require performance improvements to the `perft` function.

---
*Note: This document should be reviewed and updated whenever new tests are added or existing tests are modified.*